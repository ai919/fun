# 广告位管理使用指南

## 功能概述

广告位管理系统允许您在网站的不同位置插入广告，支持代码广告、图片广告和文字广告三种类型。

## 安装步骤

### 1. 创建数据库表

首先需要运行数据库迁移文件创建 `ad_positions` 表：

```sql
-- 执行 database/016_create_ad_positions_table.sql
```

或者通过 phpMyAdmin 导入该 SQL 文件。

### 2. 访问后台管理

1. 登录后台管理系统
2. 在左侧菜单中找到"广告位管理"（📢 图标）
3. 点击进入广告位管理页面

## 广告位位置

系统预设了以下9个广告位：

### 首页广告位
- **home_top** - 首页顶部横幅（Header下方）
- **home_middle** - 首页中间广告（测验列表中间）
- **home_bottom** - 首页底部广告（页面底部）

### 测验页广告位
- **test_top** - 测验页顶部（题目上方）
- **test_middle** - 测验页中间（每3题后插入）
- **test_bottom** - 测验页底部（提交按钮上方）

### 结果页广告位
- **result_top** - 结果页顶部（结果上方）
- **result_middle** - 结果页中间（结果描述后）
- **result_bottom** - 结果页底部（页面底部）

## 广告类型

### 1. 代码广告（推荐）
- 支持 HTML 和 JavaScript 代码
- 适用于 Google AdSense、百度联盟等第三方广告平台
- 直接粘贴广告代码即可

**示例：**
```html
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-xxxxxxxxxxxxx"
     data-ad-slot="xxxxxxxxxx"
     data-ad-format="auto"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
```

### 2. 图片广告
- 需要提供图片 URL
- 可设置链接地址（点击图片跳转）
- 可设置 Alt 文本（SEO 友好）

**适用场景：**
- 推广自己的产品/服务
- 合作伙伴广告
- 品牌展示

### 3. 文字广告
- 纯文字内容
- 可设置链接地址
- 简洁轻量

**适用场景：**
- 简单的文字推广
- 友情链接
- 公告通知

## 配置选项

### 基本设置
- **广告位标识**：唯一标识符，如 `home_top`（必填）
- **广告位名称**：便于识别的名称（必填）
- **广告类型**：选择代码/图片/文字（必填）

### 显示控制
- **显示页面**：指定在哪些页面显示（逗号分隔：`home,test,result`，留空表示全部页面）
- **优先级**：数字越大越优先显示（当同一位置有多个广告时）
- **启用状态**：勾选后广告才会显示

### 时间控制
- **开始日期**：广告开始显示的日期时间
- **结束日期**：广告结束显示的日期时间
- 留空表示不限制时间

### 其他选项
- **最大显示次数**：限制广告显示次数（0=不限制，暂未实现统计功能）

## 使用示例

### 示例1：添加 Google AdSense 广告

1. 进入"广告位管理"
2. 点击"新建广告位"或编辑现有广告位
3. 填写信息：
   - 广告位标识：`home_top`
   - 广告位名称：首页顶部横幅
   - 广告类型：代码广告
   - 广告代码：粘贴 Google AdSense 代码
   - 显示页面：`home`
   - 优先级：`10`
   - 勾选"启用此广告位"
4. 点击"保存"

### 示例2：添加图片推广广告

1. 编辑广告位 `home_middle`
2. 选择广告类型：图片广告
3. 填写信息：
   - 图片URL：`https://example.com/promotion.jpg`
   - 链接地址：`https://example.com/promo`
   - Alt文本：`限时优惠活动`
4. 保存并启用

## 最佳实践

1. **不要过度使用广告**
   - 建议每个页面最多显示2-3个广告位
   - 避免影响用户体验

2. **选择合适的广告位置**
   - 首页顶部：适合品牌广告或重要推广
   - 内容中间：适合相关产品推荐
   - 页面底部：适合不影响阅读的广告

3. **响应式设计**
   - 确保广告代码支持移动端显示
   - 图片广告建议使用响应式图片

4. **性能优化**
   - 使用异步加载的广告代码
   - 避免阻塞页面渲染的广告脚本

5. **A/B 测试**
   - 可以创建多个相同位置的广告位
   - 通过优先级控制显示顺序
   - 测试不同广告的效果

## 技术实现

### 数据库表结构
- `ad_positions` 表存储所有广告位配置
- 支持缓存机制，提高性能

### 代码调用
前台页面通过 `AdHelper::render()` 方法显示广告：

```php
<?php
require_once __DIR__ . '/lib/AdHelper.php';
$ad = AdHelper::render('home_top', 'home');
if ($ad):
?>
    <div class="ad-wrapper">
        <?= $ad ?>
    </div>
<?php endif; ?>
```

### 缓存机制
- 广告位配置缓存5分钟
- 修改广告位后会自动清除缓存
- 可在后台手动清除缓存

## 常见问题

### Q: 为什么保存后看不到广告？
**A:** 可能的原因：
1. 未勾选"启用此广告位"
2. 当前时间不在设置的开始/结束日期范围内
3. 当前页面不在"显示页面"列表中
4. 浏览器缓存，请清除缓存或使用无痕模式

### Q: 可以同时显示多个广告吗？
**A:** 可以，但同一位置只会显示优先级最高的一个启用的广告。如果需要轮播多个广告，需要在广告代码中实现。

### Q: 支持哪些广告平台？
**A:** 支持所有提供 HTML/JavaScript 代码的广告平台，如：
- Google AdSense
- 百度联盟
- 搜狗联盟
- 360联盟
- 自定义广告代码

### Q: 如何测试广告显示？
**A:** 
1. 创建一个测试广告位
2. 使用明显的测试内容（如彩色背景、大字体）
3. 在对应页面查看是否显示
4. 确认无误后替换为真实广告代码

## 注意事项

1. **广告内容合规**
   - 确保广告内容符合相关法律法规
   - 避免违规内容

2. **用户体验**
   - 不要使用弹窗广告
   - 避免影响页面加载速度
   - 保持广告与内容的相关性

3. **SEO 影响**
   - 过多的广告可能影响 SEO
   - 建议使用 `rel="nofollow noopener"` 属性

4. **数据统计**
   - 建议使用 Google Analytics 等工具统计广告效果
   - 定期检查广告点击率和转化率

